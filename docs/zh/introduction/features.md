# 核心功能

MSM 提供完整的旁路由 DNS 分流和透明代理解决方案，以下是详细功能介绍。

## 🌐 DNS 智能分流

### 域名规则分流

- **国内域名直连**: 自动识别国内域名，使用国内 DNS 解析，直连访问
- **国外域名代理**: 国外域名返回 FakeIP，通过代理访问
- **自定义规则**: 支持域名白名单、黑名单、自定义分流规则
- **GeoIP 分流**: 基于 IP 地理位置的智能分流

### FakeIP 模式

- **高效代理**: 使用 28.0.0.0/8 网段作为 FakeIP 池
- **减少泄漏**: 避免 DNS 泄漏，提高隐私保护
- **快速响应**: 无需等待真实 DNS 解析，提高访问速度
- **自动映射**: FakeIP 与真实域名自动映射管理

### DNS 缓存

- **智能缓存**: 缓存 DNS 查询结果，减少重复查询
- **TTL 管理**: 遵循 DNS TTL 规则，自动更新缓存
- **缓存统计**: 查看缓存命中率和性能统计
- **手动清理**: 支持手动清理 DNS 缓存

## 🔄 透明代理

### 多协议支持

- **Shadowsocks**: SS/SSR 协议支持
- **VMess**: V2Ray VMess 协议
- **Trojan**: Trojan 协议
- **VLESS**: VLESS 协议
- **Hysteria**: Hysteria/Hysteria2 协议
- **其他协议**: SOCKS5, HTTP, HTTPS 等

### 代理模式

- **TProxy**: 透明代理模式（推荐）
- **Redirect**: 重定向模式
- **TUN**: TUN 模式（实验性）
- **混合模式**: 同时支持多种代理模式

### 规则分流

- **域名规则**: 基于域名的分流规则
- **IP 规则**: 基于 IP 地址的分流规则
- **GeoIP 规则**: 基于地理位置的分流规则
- **进程规则**: 基于进程的分流规则（部分支持）

### 负载均衡

- **多节点支持**: 配置多个代理节点
- **自动切换**: 节点故障自动切换
- **负载均衡**: 多节点负载均衡
- **延迟测试**: 自动测试节点延迟

## 🛡️ 设备管理

### IP 白名单

- **精确控制**: 通过 IP 地址控制哪些设备走代理
- **批量管理**: 支持批量添加/删除设备
- **设备备注**: 为每个设备添加备注说明
- **快速切换**: 一键启用/禁用设备代理

### 设备分组

- **分组管理**: 将设备分组管理（如家庭、办公室）
- **组规则**: 为不同组设置不同的代理规则
- **批量操作**: 对整个组进行批量操作
- **组统计**: 查看每个组的流量统计

### 设备发现

- **自动发现**: 自动发现局域网内的设备
- **设备信息**: 显示设备 MAC 地址、主机名等信息
- **在线状态**: 实时显示设备在线状态
- **历史记录**: 记录设备连接历史

## 🖥️ 可视化管理

### 服务管理

- **一键安装**: 自动下载和安装 MosDNS、SingBox、Mihomo
- **版本管理**: 支持安装多个版本，一键切换
- **启停控制**: 一键启动/停止/重启服务
- **状态监控**: 实时查看服务运行状态

### 配置编辑

- **在线编辑**: 基于 Monaco Editor 的在线配置编辑器
- **语法高亮**: YAML/JSON 语法高亮
- **自动补全**: 智能代码补全
- **错误提示**: 实时语法检查和错误提示
- **格式化**: 一键格式化配置文件

### 配置历史

- **自动保存**: 每次修改自动保存历史版本
- **版本对比**: 可视化对比不同版本的差异
- **一键回滚**: 快速回滚到任意历史版本
- **备注说明**: 为每个版本添加备注

### 实时日志

- **实时推送**: WebSocket 实时推送日志
- **日志过滤**: 按级别、关键词过滤日志
- **日志搜索**: 搜索历史日志
- **日志导出**: 导出日志文件

## 📊 监控统计

### 服务状态

- **运行状态**: 实时显示服务运行状态
- **进程信息**: 显示进程 PID、运行时间
- **端口占用**: 显示端口占用情况
- **资源使用**: CPU、内存使用率

### 流量统计

- **实时流量**: 实时显示上传/下载速度
- **流量统计**: 按时间统计流量使用
- **设备流量**: 查看每个设备的流量使用
- **流量图表**: 可视化流量趋势图

### DNS 统计

- **查询统计**: DNS 查询次数统计
- **缓存命中率**: DNS 缓存命中率
- **分流统计**: 国内/国外域名分流统计
- **热门域名**: 查询最频繁的域名

### 代理统计

- **连接数**: 当前代理连接数
- **节点状态**: 代理节点状态和延迟
- **流量统计**: 代理流量统计
- **错误统计**: 代理错误和失败统计

## 🔌 路由器集成

### 广泛兼容

支持所有能够配置静态路由和自定义 DNS 的路由系统：

- **RouterOS** (MikroTik): 完整支持，包括 Netwatch 自动切换
- **爱快** (iKuai): 完整支持，Web 界面配置
- **OpenWrt**: 完整支持，LuCI 界面配置
- **UniFi** (Ubiquiti): 完整支持，Controller 配置
- **梅林固件**: 完整支持，Web 界面配置
- **pfSense/OPNsense**: 完整支持，Web 界面配置
- **其他路由器**: 只要支持静态路由和自定义 DNS 即可

### 配置简单

只需在路由器上配置两项：

1. **DNS 设置**: 将主路由的 DNS 设置为 MSM 主机 IP
2. **静态路由**: 添加 `28.0.0.0/8` 指向 MSM 主机 IP

### 故障自动切换

- **健康检查**: 路由器定期检查 MSM 服务状态
- **自动切换**: MSM 故障时自动切换到备用 DNS
- **自动恢复**: MSM 恢复后自动切回
- **无缝切换**: 切换过程不影响正常上网

## 🔐 安全特性

### 用户认证

- **JWT 认证**: 基于 JWT 的安全认证
- **多用户支持**: 支持创建多个用户账号
- **角色权限**: 管理员、运维、只读等多级权限
- **会话管理**: 会话超时自动登出

### 操作审计

- **操作日志**: 记录所有用户操作
- **登录日志**: 记录登录历史和 IP
- **配置变更**: 记录配置变更历史
- **审计导出**: 导出审计日志

### 数据安全

- **密码加密**: bcrypt 加密存储密码
- **HTTPS 支持**: 支持 HTTPS 加密传输
- **数据备份**: 支持配置和数据备份
- **数据恢复**: 支持从备份恢复

## ⚡ 性能优化

### 高性能

- **Golang 后端**: 高并发处理能力
- **异步处理**: 异步处理耗时操作
- **连接池**: 数据库连接池复用
- **缓存机制**: 多级缓存提高性能

### 低资源占用

- **内存优化**: 最低 512MB 内存即可运行
- **CPU 优化**: 低 CPU 占用，不影响其他服务
- **磁盘优化**: 日志自动清理，避免磁盘占满
- **网络优化**: 优化网络传输，减少带宽占用

## 📦 部署方式

### 单二进制部署

- **零依赖**: 无需安装任何依赖
- **开箱即用**: 下载即可运行
- **体积小**: 压缩后约 15-23MB
- **跨平台**: 支持 Linux、macOS 多架构

### Docker 部署

- **官方镜像**: 提供官方 Docker 镜像
- **多架构**: 支持 amd64/arm64 架构
- **Docker Compose**: 提供 docker-compose.yml
- **自动更新**: 支持自动更新镜像

### 系统服务

- **Systemd**: 支持 systemd 服务管理
- **开机自启**: 支持开机自动启动
- **服务守护**: 服务异常自动重启
- **日志管理**: 集成 journald 日志

## 🌍 国际化

### 多语言

- **简体中文**: 完整的中文界面
- **English**: 完整的英文界面
- **语言切换**: 无需刷新即可切换语言
- **更多语言**: 支持扩展更多语言

### 本地化

- **时间格式**: 根据语言自动调整时间格式
- **日期格式**: 根据语言自动调整日期格式
- **数字格式**: 根据语言自动调整数字格式

## 下一步

- [安装部署](/zh/guide/install) - 开始安装 MSM
- [路由器集成](/zh/guide/router-integration) - 配置路由器
- [使用指南](/zh/guide/basic-config) - 基础配置和使用
